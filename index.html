<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>√Ålbum da Yasmin üíñ</title>

<style>
body{font-family:Arial;background:#fad0c4;text-align:center;margin:0}
.foto{background:white;margin:15px auto;padding:10px;width:300px;border-radius:10px}
img{width:100%;border-radius:10px}
textarea{width:90%}
button{margin-top:8px}
</style>
</head>
<body>

<h1>√Ålbum da Yasmin üì∏üíñ</h1>

<div id="login">
    <input id="email" placeholder="Email"><br><br>
    <input id="senha" type="password" placeholder="Senha"><br><br>
    <button id="btnLogin">Entrar (Yasmin)</button>
</div>

<div id="postar" style="display:none;">
    <input type="file" id="foto"><br><br>
    <textarea id="desc" placeholder="Descri√ß√£o"></textarea><br>
    <button id="btnPostar">Postar Foto</button>
    <hr>
</div>

<div id="galeria"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
import { getFirestore, addDoc, collection, onSnapshot, doc, updateDoc, arrayUnion } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

const firebaseConfig = {
    apiKey: "AIzaSyD-sZuEWfcj8sRj9deQOCpNNUjCDyGHoHI",
    authDomain: "album-yasmin.firebaseapp.com",
    projectId: "album-yasmin",
    storageBucket: "album-yasmin.firebasestorage.app",
    messagingSenderId: "689023295825",
    appId: "1:689023295825:web:c0989660f596542eadb370"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();
const storage = getStorage();

document.getElementById("btnLogin").addEventListener("click", async () => {
    const email = document.getElementById('email').value;
    const senha = document.getElementById('senha').value;

    try {
        await signInWithEmailAndPassword(auth, email, senha);
        document.getElementById('postar').style.display='block';
        document.getElementById('login').style.display='none';
        alert("Login feito!");
    } catch(e){
        alert(e.message);
    }
});

document.getElementById("btnPostar").addEventListener("click", async () => {
    const file = document.getElementById('foto').files[0];
    const desc = document.getElementById('desc').value;

    const storageRef = ref(storage, 'fotos/'+Date.now()+file.name);
    await uploadBytes(storageRef, file);
    const url = await getDownloadURL(storageRef);

    await addDoc(collection(db, "fotos"), {
        url: url,
        descricao: desc,
        comentarios: []
    });
});

const galeria = document.getElementById('galeria');

onSnapshot(collection(db,"fotos"), (snapshot)=>{
    galeria.innerHTML="";
    snapshot.forEach(docu=>{
        const d = docu.data();
        const div = document.createElement('div');
        div.className="foto";
        div.innerHTML=`
            <img src="${d.url}">
            <p>${d.descricao}</p>
            <textarea placeholder="Comentar"></textarea>
            <button>Comentar</button>
            <div>${d.comentarios.map(c=>"<p>üí¨ "+c+"</p>").join("")}</div>
        `;
        div.querySelector("button").onclick = async function(){
            const texto = div.querySelector("textarea").value;
            const docRef = doc(db,"fotos",docu.id);
            await updateDoc(docRef,{
                comentarios: arrayUnion(texto)
            });
        };
        galeria.appendChild(div);
    });
});
</script>

</body>
</html>
